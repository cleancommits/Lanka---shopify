{% comment %}theme-check-disable RemoteAsset, TemplateLength{% endcomment %}
{%- comment -%}
  Render product card

  Accepts:
    - id: {String} Unique id of the item. By default section_id--current_product.id is used (optional)
    - current_product: {Object} Product object (optional)
    - section_id: {String} Section id (optional)
    - collection: {Object} Collection if product is within one
    - image_ratio: {String} Image ratio string. Values are "1:1", "3:4", "4:3", "16:9", "2:3", "natural"
    - image_sizes: {String} Image sizes attribute string
    - fit_image_to_container: {Boolean} Fit image into container, or resize (optional)
    - small_buttons_on_mobile: {Boolean} Small buttons on the image grid @ mobile size
    - hide_labels: {Boolean} Hide card labels (optional)
    - enable_quick_shop: {Boolean} Enable quick shop (optional)
    - quick_shop_trigger: {String} button, button-hover, icon, icon-hover (optional)
    - quick_shop_type: {String} rendered (default) / remote
    - show_swatches: {Boolean} Show swatches

  Ideas for dynamically generated product cards:
    - have some inside web-components responsible for fetching
      unnaccessible information, ie labels, reviews, etc - create
      custom layout-less tempaltes just for them, and fetch via product
      endpoint
    - alternatively (for labels) cycle through store collections,
      and create a json object with collection ids and all product ids
      in each
    - for now, no labels and reviews
{%- endcomment -%}
{%- liquid
  unless image_ratio
    assign image_ratio = settings.product_grid_image_size
  endunless

  if fit_image_to_container == null
    assign fit_image_to_container = settings.product_grid_image_fit
  endif

  if hide_labels == null
    assign hide_labels = false
  endif

  if enable_quick_shop == null
    assign enable_quick_shop = settings.quick_shop_enabled
  endif

  if quick_shop_trigger == null
    assign quick_shop_trigger = settings.quick_shop_trigger
  endif

  if quick_shop_type == null
    assign quick_shop_type = 'rendered'
  endif

  if show_swatches == null
    assign show_swatches = settings.product_grid_show_swatches
  endif

  assign container_ratio = image_ratio

  unless image_sizes
    assign image_sizes = '100vw'
  endunless

  assign swatches_enabled = false
  if settings.swatches_trigger != blank and settings.swatches_enabled and show_swatches
    assign swatches_enabled = true
  endif

  comment
    Quickshop settings
  endcomment
  if enable_quick_shop
    assign quick_shop_trigger_split = quick_shop_trigger | split: '-'
    assign quick_shop_trigger = quick_shop_trigger_split | first

    assign quick_shop_hover_enabled = false
    if quick_shop_trigger_split.size > 1
      assign quick_shop_hover_enabled = true
    endif

    if current_product
      if quick_shop_trigger == 'icon'
        assign render_quickshop = true
      elsif current_product.variants.size > 1 and current_product.available and quick_shop_trigger == 'button'
        assign render_quickshop = true
      else
        assign render_quickshop = false
      endif
    else
      assign render_quickshop = true
    endif

    assign quick_shop_icon_hover = false
    if quick_shop_trigger == 'icon' and quick_shop_hover_enabled
      assign quick_shop_icon_hover = true
    endif

    assign quick_shop_image_sizes = '(min-width: 444px) 360px, calc(100vw - 24px - 18px * 2)'
    if quick_shop_icon_hover
      comment
        TODO: Pass product card image sizes to quick-shop if hover state enabled
      endcomment
    endif
  else
    assign quick_shop_trigger = null
  endif

  assign product_card_classes = 'product-card js-product js-product-card'
  if fit_image_to_container
    assign product_card_classes = product_card_classes | append: ' product-card--fit'
  else
    assign product_card_classes = product_card_classes | append: ' product-card--crop'
  endif
  if settings.product_grid_align
    assign product_card_classes = product_card_classes | append: ' product-card--center'
  else
    assign product_card_classes = product_card_classes | append: ' product-card--left'
  endif
  if quick_shop_trigger
    assign product_card_classes = product_card_classes | append: ' product-card--trigger-' | append: quick_shop_trigger
  endif
  if quick_shop_hover_enabled
    assign product_card_classes = product_card_classes | append: ' product-card--hover'
  endif

  assign image = null
  assign enable_secondary_image = false
  if settings.product_grid_hover == 'image'
    assign enable_secondary_image = true
  endif

  if current_product
    assign current_variant = current_product.selected_or_first_available_variant

    comment
      Process all imges (main and hover)
    endcomment
    if current_product.featured_media.preview_image != null
      assign image = current_product.featured_media.preview_image

      assign secondary_image = null
      if settings.product_grid_hover == 'image' and quick_shop_icon_hover == false and current_product.media[1] != blank
        assign secondary_image = current_product.media[1].preview_image
      elsif enable_quick_shop == false and settings.product_grid_hover == 'image' and current_product.media[1] != blank
        assign secondary_image = current_product.media[1].preview_image
      endif
    endif

    if container_ratio == 'natural'
      assign image_container_bottom_padding = '100%'
      if current_product and current_product.featured_media.preview_image != null
        assign image_container_bottom_padding = 1 | divided_by: current_product.featured_media.preview_image.aspect_ratio | times: 100 | append: '%'
      endif
    endif

    unless current_product.available
      assign product_card_classes = product_card_classes | append: ' product-card--sold-out'
    endunless
    if current_product.compare_at_price > current_product.price and current_product.available
      assign product_card_classes = product_card_classes | append: ' product-card--sale'
    endif
    if settings.product_grid_align
      assign product_card_classes = product_card_classes | append: ' product-card--center'
    else
      assign product_card_classes = product_card_classes | append: ' product-card--left'
    endif
    comment
      if page == 'home'
        assign product_card_classes = product_card_classes | append: ' home-products__item'
      endif
    endcomment

    assign link = current_product.url | within: collection

    if secondary_image
      assign product_card_classes = product_card_classes | append: ' product-card--hover-image'
    elsif settings.product_grid_hover == 'zoom'
      assign product_card_classes = product_card_classes | append: ' product-card--hover-zoom'
    endif
  else
    assign link = '#'

    if settings.product_grid_hover == 'zoom'
      assign product_card_classes = product_card_classes | append: ' product-card--hover-zoom'
    endif
  endif
-%}
{%- if current_product and hide_labels == false -%}
  {%- capture labels -%}
    {% render 'product-grid-label', product: current_product %}
  {%- endcapture -%}
{%- endif -%}
<product-card
  {% if current_product %}
    rendered
    data-product-id="{{ current_product.id }}"
  {% endif %}
  class="{{ product_card_classes }}"
  image-container-ratio="{{ container_ratio }}"
  image-hover="{{ settings.product_grid_hover }}"
  {% if fit_image_to_container %}
    image-fit
  {% endif %}
  {% if section %}
    section-id="{{ section_id }}"
  {% endif %}
  {% if quick_shop_trigger %}
    quick-shop-trigger="{{ quick_shop_trigger }}"
  {% endif %}
>
  {{ labels }}
  <div class="product-card-top">
    <div
      class="
        o-ratio
        o-ratio--{{ container_ratio }}
      "
      {% if image_container_bottom_padding %}
        style="padding-bottom:{{ image_container_bottom_padding }}"
      {% endif %}
    >
      <div class="o-ratio__content">
        <a
          product-card-link
          href="{{ link }}"
          class="product-card__link product-card__link--full-opacity"
          tabindex="-1"
        >
          <div
            class="
              product-card__media
              {% if current_product %}
                {% if secondary_image %} product-card__media--hover-image{% elsif settings.product_grid_hover == 'zoom' %} product-card__media--hover-zoom{% endif %}
                product-card__media--swatch-overlay
              {% endif %}
            "
          >
            {%- if enable_secondary_image -%}
              <product-card-secondary-image-placeholder
                class="product-card__img-hover hover-enabled"
                {% unless current_product %}
                  hidden
                {% endunless %}
              >
                {%- if secondary_image -%}
                  {% render 'image',
                    image: secondary_image,
                    additional_classes: 'product-card__img-hover hover-enabled',
                    image_ratio: container_ratio,
                    image_fit: fit_image_to_container,
                    image_srcset_widths: '120, 240, 360, 480, 620, 740',
                    image_sizes: image_sizes
                  %}
                {%- endif -%}
              </product-card-secondary-image-placeholder>
            {%- endif -%}

            {% render 'theme-spinner', tag: 'product-card-spinner', additional_classes: 'product-card__spinner' %}

            {%- liquid
              assign image_classes = 'product-card__img'
              if settings.product_grid_hover == 'image'
                assign image_classes = image_classes | append: ' hover-enabled'
              endif
            -%}
            {% render 'image',
              image: image,
              additional_attributes: 'product-card-image',
              additional_classes: image_classes,
              image_ratio: container_ratio,
              image_fit: fit_image_to_container,
              image_srcset_widths: '180, 360, 540, 720, 900, 1080, 1296, 1512',
              image_sizes: image_sizes,
              render_skeleton: true
            %}

            {%- if current_product and current_product.available == false -%}
              <div class="product-card__out-of-stock-line"></div>
            {%- endif -%}

            {%- if current_product and current_product.variants.size > 1 -%}
                <style>
                    .product-card__media--swatch-overlay {
                    position: relative;
                    }
                    .product-card__swatch-overlay {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    margin: 0;
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(10px);
                    border-radius: 0;
                    padding: 4px 4px;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    z-index: 15;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    }
                    .product-card__media:hover .product-card__swatch-overlay,
                    .product-card__media--hover .product-card__swatch-overlay {
                    opacity: 1;
                    visibility: visible;
                    transform: translateY(-2px);
                    }
                    .product-card__swatch__items {
                    margin: 0;
                    padding: 0;
                    list-style: none;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 4px;
                    flex-wrap: nowrap;
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                    scrollbar-width: none;
                    -ms-overflow-style: none;
                    }
                    .product-card__swatch__items::-webkit-scrollbar {
                    display: none;
                    }
                    .product-card__swatch__item {
                    margin: 0;
                    flex-shrink: 0;
                    }
                    .product-card__swatch__graphic {
                    width: 32px;
                    height: 32px;
                    background: #ffffff;
                    border: 2px solid #000000;
                    border-radius: 2px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 14px;
                    font-weight: 600;
                    color: #000000;
                    text-align: center;
                    line-height: 1.2;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    position: relative;
                    overflow: hidden;
                    white-space: nowrap;
                    }
                    .product-card__swatch__graphic:hover {
                    transform: scale(1.05);
                    border-color: #666666;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    background: #f8f8f8;
                    }
                    .product-card__swatch__graphic.active {
                    border-color: #000000;
                    background: #f0f0f0;
                    }
                    .product-card__swatch__graphic.disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                    }
                    .product-card__swatch__graphic.disabled::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(to bottom right, transparent 49%, #ff0000 50%, #ff0000 51%, transparent 52%);
                    pointer-events: none;
                    }
                    .product-card__out-of-stock-line {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(to bottom right, transparent 49%, #ff0000 50%, #ff0000 51%, transparent 52%);
                    pointer-events: none;
                    z-index: 10;
                    }
                    .product-card__overflow__item {
                    position: absolute;
                    right: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    width: 28px;
                    height: 28px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    font-weight: 600;
                    text-decoration: none;
                    z-index: 20;
                    transition: all 0.2s ease;
                    border: none;
                    }
                    .product-card__overflow__item:hover {
                    background: rgba(0, 0, 0, 1);
                    transform: translateY(-50%) scale(1.1);
                    }
                    .product-card__btn-overlay {
                    position: absolute;
                    bottom: 80px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: calc(100% - 24px);
                    max-width: 200px;
                    z-index: 16;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    }
                    .product-card__media:hover .product-card__btn-overlay,
                    .product-card__media--hover .product-card__btn-overlay {
                    opacity: 1;
                    visibility: visible;
                    transform: translateX(-50%) translateY(-4px);
                    }
                    @media (max-width: 749px) {
                    .product-card__swatch-overlay {
                        bottom: 0;
                        padding: 6px 8px;
                    }
                    .product-card__swatch__graphic {
                        width: 32px;
                        height: 32px;
                        font-size: 12px;
                    }
                    .product-card__overflow__item {
                        width: 24px;
                        height: 24px;
                        right: 8px;
                        font-size: 11px;
                    }
                    .product-card__btn-overlay {
                        bottom: 72px;
                        max-width: 160px;
                    }
                    .product-card__swatch__graphic.disabled::after {
                        background: linear-gradient(to bottom right, transparent 48%, #ff0000 49%, #ff0000 51%, transparent 52%);
                    }
                    .product-card__out-of-stock-line {
                        background: linear-gradient(to bottom right, transparent 48%, #ff0000 49%, #ff0000 51%, transparent 52%);
                    }
                }
                </style>

                {%- assign size_option_index = -1 -%}
                    {%- comment -%} Find Size Option Index {%- endcomment -%}
                    {%- for option in current_product.options -%}
                        {%- assign size_option_index = forloop.index0 -%}
                        {%- break -%}
                    {%- endfor -%}
                    
                    {%- comment -%} If no size option found, use first option {%- endcomment -%}
                    {%- unless size_option_index >= 0 -%}
                    {%- assign size_option_index = 0 -%}
                    {%- endunless -%}

                    <script>
                        console.log('=== SIZE SWATCH DEBUG ===');
                        console.log('Product:', {{ current_product.title | json }});
                        console.log('Options:', {{ current_product.options | json }});
                        console.log('Size Index:', {{ size_option_index | json }});
                        console.log('Variant Count:', {{ current_product.variants.size | json }});
                    </script>

                    {%- comment -%} Render Size Swatches {%- endcomment -%}
                    <div class="product-card__swatch-overlay">
                        <ul class="product-card__swatch__items">
                            {%- assign values = '' -%}
                            {%- assign swatch_count = 0 -%}
                            {%- assign rendered_count = 0 -%}
                            
                            {%- for variant in current_product.variants -%}
                                {%- assign value = variant.options[size_option_index] -%}
                                {%- assign value_stripped = value | strip -%}
                                
                                {%- unless value_stripped == blank -%}
                                {%- capture wrapped_value -%},{{ value_stripped }},{%- endcapture -%}
                                {%- unless values contains wrapped_value -%}
                                    {%- assign swatch_count = swatch_count | plus: 1 -%}
                                    {%- assign swatch_variant_ids = swatch_variant_ids | append: variant.id | append: ',' -%}
                                    
                                    {%- if swatch_count <= 6 -%}
                                    {%- assign rendered_count = rendered_count | plus: 1 -%}
                                    {%- assign is_active = false -%}
                                    {%- assign is_disabled = variant.available | not -%}
                                    {%- if current_variant and current_variant.options[size_option_index] == value_stripped -%}
                                        {%- assign is_active = true -%}
                                    {%- endif -%}
                                    
                                    <li class="product-card__swatch__item o-list-inline__item" data-variant-id="{{ variant.id }}">
                                        <div
                                        class="product-card__swatch__graphic js-variant-swatch {%- if is_active %} active{% endif %} {%- if is_disabled %} disabled{% endif %}"
                                        data-variant-id="{{ variant.id }}"
                                        data-option-value="{{ value_stripped | escape }}"
                                        title="{{ value_stripped | escape }}{% if is_disabled %} - Out of Stock{% endif %}"
                                        {% if is_disabled %}aria-disabled="true"{% endif %}
                                        >
                                        {{ value_stripped }}
                                        </div>
                                    </li>
                                    {%- endif -%}
                                    
                                    {%- capture values -%}{{ values }}{{ wrapped_value }}{%- endcapture -%}
                                {%- endunless -%}
                                {%- endunless -%}
                            {%- endfor -%}
                        </ul>

                        {%- comment -%} Overflow Indicator {%- endcomment -%}
                        {%- if swatch_count > 6 -%}
                        <a
                            href="{{ current_product.url | within: collection }}"
                            class="product-card__overflow__item"
                            title="{{ current_product.title }} - {{ swatch_count | minus: 6 }} more sizes"
                            aria-label="{{ swatch_count | minus: 6 }} more sizes available"
                        >
                            <span>+{{ swatch_count | minus: 6 }}</span>
                        </a>
                        {%- endif -%}
                    </div>
                    <script>
                        (function() {
                            'use strict';
                            
                            function initProductSwatches() {
                                const swatches = document.querySelectorAll('.js-variant-swatch');
                                console.log('Found', swatches.length, 'size swatches for {{ current_product.title | escape }}');
                                
                                if (swatches.length === 0) {
                                    console.log('No swatches found - skipping initialization');
                                    return;
                                }
                                
                                swatches.forEach(function(swatch, index) {
                                    const variantId = swatch.getAttribute('data-variant-id');
                                    const optionValue = swatch.getAttribute('data-option-value');
                                    const isActive = swatch.classList.contains('active');
                                    const isDisabled = swatch.classList.contains('disabled');
                                    
                                    console.log(`Swatch ${index + 1}:`, {
                                        variantId: variantId,
                                        size: optionValue,
                                        active: isActive,
                                        disabled: isDisabled
                                    });
                                    
                                    const newSwatch = swatch.cloneNode(true);
                                    swatch.parentNode.replaceChild(newSwatch, swatch);
                                    
                                    if (!isDisabled) {
                                        newSwatch.addEventListener('click', function(e) {
                                            e.preventDefault();
                                            e.stopPropagation();
                                            
                                            console.log('Size swatch clicked:', optionValue, 'Variant:', variantId);
                                            
                                            swatches.forEach(function(s) { 
                                                s.classList.remove('active'); 
                                            });
                                            
                                            this.classList.add('active');
                                            
                                            const productForm = document.querySelector(`[data-product-id="{{ current_product.id }}"] form`);
                                            if (productForm) {
                                                const variantInput = productForm.querySelector('select[name="id"], input[name="id"]');
                                                if (variantInput) {
                                                    variantInput.value = variantId;
                                                    variantInput.dispatchEvent(new Event('change', { bubbles: true }));
                                                    console.log('Updated form variant input');
                                                }
                                            }
                                            
                                            const productCard = this.closest('.product-card');
                                            if (productCard) {
                                                productCard.dispatchEvent(new CustomEvent('variant:change', {
                                                    detail: { variantId: variantId, optionValue: optionValue },
                                                    bubbles: true
                                                }));
                                            }
                                            
                                            document.dispatchEvent(new CustomEvent('variant:change', {
                                                detail: { 
                                                    productId: {{ current_product.id }}, 
                                                    variantId: variantId, 
                                                    optionValue: optionValue 
                                                },
                                                bubbles: true
                                            }));
                                            
                                            console.log('All events dispatched successfully');
                                        });
                                    }
                                });
                            }
                            
                            setTimeout(initProductSwatches, 50);
                            if (document.readyState === 'loading') {
                                document.addEventListener('DOMContentLoaded', initProductSwatches);
                            } else {
                                initProductSwatches();
                            }
                            setTimeout(initProductSwatches, 500);
                            document.addEventListener('shopify:section:load', initProductSwatches);
                            document.addEventListener('shopify:block:load', initProductSwatches);
                        })();
                    </script>
                  {%- endif -%}
          </div>
        </a>
      </div>
    </div>

    {%- if quick_shop_trigger == 'button' -%}
      {% comment %} TODO: Rename class properly {% endcomment %}
      <product-card-button class="product-card-btn">
        {%- if current_product -%}
          {%- if current_product.available == false -%}
            <button
              type="submit"
              class="c-btn c-btn--full{% if settings.quick_shop_product_grid_button == 'outline' %} c-btn--hollow{% else %} c-btn--primary{% endif %} product-card-btn__btn {% if small_buttons_on_mobile %}c-btn--small@mobile{% endif %}"
              disabled="disabled"
            >
              {{ 'products.product.sold_out' | t }}
            </button>
          {%- elsif current_product.variants.size > 1 %}
            <a
              href="{{ current_product.url | within: collection }}"
              class="c-btn c-btn--full{% if settings.quick_shop_product_grid_button == 'outline' %} c-btn--hollow{% else %} c-btn--primary{% endif %} {% if small_buttons_on_mobile %}c-btn--small@mobile{% endif %} product-card-btn__btn js-quickshop-trigger"
              aria-hidden="true"
              tabindex="-1"
            >
              {{- 'products.product.select_options' | t -}}
            </a>
          {%- else -%}
            <product-form
              {% if settings.quick_shop_show_cart %}
                notify-on-add
              {% endif %}
            >
              {% form 'product', current_product %}
                <input type="hidden" name="id" value="{{ current_product.variants.first.id }}">
                <button
                  type="submit"
                  name="add"
                  class="c-btn c-btn--full{% if settings.quick_shop_product_grid_button == 'outline' %} c-btn--hollow{% else %} c-btn--primary{% endif %} {% if small_buttons_on_mobile %}c-btn--small@mobile{% endif %} product-card-btn__btn"
                  aria-hidden="true"
                  tabindex="-1"
                >
                  <span class="product-card-btn__text">{{ 'products.product.add_to_cart' | t }}</span>
                  <span class="product-card-btn__tick"><i class="icon icon--tick"></i></span>
                  <product-card-button-spinner class="product-card-btn__spinner">
                    {% render 'theme-spinner' %}
                  </product-card-button-spinner>
                </button>
              {% endform %}
            </product-form>
          {%- endif -%}
        {%- endif -%}
      </product-card-button>
    {%- endif -%}

    {%- if quick_shop_trigger == 'icon' -%}
      <button quickshop-trigger class="quick-shop__trigger js-quickshop-trigger" aria-hidden="true" tabindex="-1">
        {% render 'icon-quickbuy' %}
      </button>
    {%- endif -%}
  </div>
  <div class="product-card__details">
    <a
      product-card-link
      href="{{ link }}"
      class="product-card__link"
      {% if current_product %}
        title="{{ current_product.title }}"
      {% endif %}
    >
      {%- if settings.product_grid_vendor -%}
        <product-card-vendor class="product-card__vendor u-medium-small h3">
          {{- current_product.vendor -}}
        </product-card-vendor>
      {%- endif -%}
      <h3 class="product-card__title f-family--{{ settings.type_grid_style }} f-caps--{{ settings.type_grid_capitalize }} f-space--{{ settings.type_grid_letterspace }}">
        <product-card-title>{{- current_product.title -}}</product-card-title>
      </h3>
    </a>
    <div class="product-card__details__hover u-medium">
      <a
        product-card-link
        href="{{ link }}"
        class="product-card__link"
        tabindex="-1"
        {% if current_product %}
          title="{{ current_product.title }}"
        {% endif %}
      >
        {%- if settings.product_grid_price -%}
          <product-card-price class="price">
            {%- if current_product -%}
              {% render 'product-price', product: current_product, from_price: true, show_price_notes: false %}
            {%- endif -%}
          </product-card-price>
          {%- if current_product.available and current_variant.unit_price_measurement or current_product == blank -%}
            <product-card-price-notes class="price__notes">
              {%- if current_product -%}
                <span class="price__note price__note--unit">
                  {% render 'product-unit-price', product: current_product, variant: current_variant %}
                </span>
              {%- endif -%}
            </product-card-price-notes>
          {%- endif -%}
        {%- endif -%}

        {%- if settings.product_grid_reviews -%}
          <product-card-reviews
            class="review-wrapper"
            {% unless current_product %}
              hidden
            {% endunless %}
          >
            {%- if current_product.metafields.reviews.rating.value != blank -%}
              {%- liquid
                assign rating_decimal = 0
                assign decimal = current_product.metafields.reviews.rating.value.rating | modulo: 1
                if decimal >= 0.3 and decimal <= 0.7
                  assign rating_decimal = 0.5
                elsif decimal > 0.7
                  assign rating_decimal = 1
                endif
              -%}
              <div
                class="rating"
                role="img"
                aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: current_product.metafields.reviews.rating.value, rating_max: current_product.metafields.reviews.rating.value.scale_max }}"
              >
                <span
                  aria-hidden="true"
                  class="rating-star color-icon-{{ settings.accent_icons }}"
                  style="--rating: {{ current_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ current_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                ></span>
              </div>
              <div class="review-text-wrapper">
                <p class="rating-text caption">
                  <span aria-hidden="true">
                    {{- current_product.metafields.reviews.rating.value }} /
                    {{ current_product.metafields.reviews.rating.value.scale_max -}}
                  </span>
                </p>
                <p class="rating-count u-small caption">
                  <span aria-hidden="true">({{ current_product.metafields.reviews.rating_count }})</span>
                  <span class="visually-hidden">{{ current_product.metafields.reviews.rating_count }}</span>
                </p>
              </div>
            {%- endif -%}
          </product-card-reviews>
        {%- endif -%}
      </a>
    </div>
  </div>
  {%- if render_quickshop -%}
    {%- if current_product -%}
      {%- liquid
        if quick_shop_type == 'rendered'
          render 'quick-shop', product: current_product, image_ratio: container_ratio, image_sizes: quick_shop_image_sizes, fit_image_to_container: image_fit
        else
          assign load_on = 'click'
          if quick_shop_icon_hover
            assign load_on = 'proximity'
          endif
          render 'quick-shop-placeholder', product_url: current_product.url, product_image: rendered_image, product_image_bottom_padding: image_container_bottom_padding, product_title: current_product.title, product_labels: labels, image_ratio: container_ratio, image_sizes: quick_shop_image_sizes, fit_image_to_container: image_fit, load_on: load_on
        endif
      -%}
    {%- else -%}
      <product-card-quick-shop></product-card-quick-shop>
    {%- endif -%}
  {%- endif -%}
  {%- if swatch_count > 0 and current_product -%}
    <script type="application/json" id="ProductJson-{{ id }}">
      {
        "url": "{{ current_product.url }}",
        "media": [{{ current_product.media[0] | json }}],
        "variants": [
          {%- for variant in current_product.variants -%}
            {%- if swatch_variant_ids contains variant.id -%}
              {%- unless forloop.first -%},{%- endunless -%}
              {
                "id": {{ variant.id }},
                "featured_media": {{ variant.featured_media | json }}
              }
            {%- endif -%}
          {%- endfor %}
        ]
      }
    </script>
  {%- endif -%}
</product-card>